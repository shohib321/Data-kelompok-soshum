<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Kelompok Siswa Sosial Humaniora</title>
    
    <!-- Google Visualization API -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', 'Segoe UI', sans-serif;
        }
        
        .font-poppins {
            font-family: 'Poppins', sans-serif;
        }
        
        .card-shadow {
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.1);
        }
        
        .card-shadow:hover {
            box-shadow: 0 15px 35px rgba(79, 70, 229, 0.15);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen p-4 md:p-6">
    
    <div class="container mx-auto max-w-7xl">
        <!-- Header Section -->
        <header class="mb-8">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-2xl p-6 md:p-8 shadow-xl overflow-hidden relative mb-6">
                <div class="absolute top-0 left-0 right-0 bottom-0 opacity-10 bg-[url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="white"/></svg>')]"></div>
                
                <div class="relative z-10 text-center">
                    <h1 class="font-poppins font-bold text-2xl md:text-3xl lg:text-4xl mb-3">
                        <i class="fas fa-users mr-3"></i>Data Kelompok Siswa Sosial Humaniora
                    </h1>
                    <p class="text-lg md:text-xl opacity-90 max-w-3xl mx-auto">
                        Database lengkap kelompok penelitian siswa dalam bidang sosial dan humaniora
                    </p>
                </div>
                
                <div class="relative z-10 mt-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
                        <!-- Total Kelompok Stats -->
                        <div class="bg-white/20 backdrop-blur-md rounded-xl p-5 text-center border border-white/30 transition-transform hover:-translate-y-1">
                            <div class="text-3xl md:text-4xl font-bold mb-1" id="totalGroups">0</div>
                            <div class="text-sm md:text-base opacity-90">Total Kelompok</div>
                        </div>
                        
                        <!-- Placeholder for additional stats if needed -->
                        <div class="bg-white/15 backdrop-blur-md rounded-xl p-5 text-center border border-white/20 flex items-center justify-center">
                            <div>
                                <i class="fas fa-chart-pie text-2xl mb-2 opacity-80"></i>
                                <div class="text-sm">5 Kategori</div>
                            </div>
                        </div>
                        
                        <div class="bg-white/15 backdrop-blur-md rounded-xl p-5 text-center border border-white/20 flex items-center justify-center">
                            <div>
                                <i class="fas fa-filter text-2xl mb-2 opacity-80"></i>
                                <div class="text-sm">Filter Data</div>
                            </div>
                        </div>
                        
                        <div class="bg-white/15 backdrop-blur-md rounded-xl p-5 text-center border border-white/20 flex items-center justify-center">
                            <div>
                                <i class="fas fa-calendar-alt text-2xl mb-2 opacity-80"></i>
                                <div class="text-sm">Data Terbaru</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Search and Filter Section -->
        <div class="mb-8">
            <div class="relative max-w-3xl mx-auto mb-6">
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-indigo-600 z-10">
                    <i class="fas fa-search"></i>
                </div>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Cari berdasarkan judul, ketua, anggota, atau kategori..." 
                    class="w-full pl-12 pr-4 py-4 bg-white rounded-xl border border-gray-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                >
                <div class="text-sm text-gray-500 mt-2 pl-2">
                    Tekan Enter untuk mencari atau gunakan filter kategori di bawah
                </div>
            </div>
            
            <!-- Category and Sort Filters -->
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <!-- Category Filter -->
                <div class="w-full md:w-auto">
                    <div class="text-sm font-medium text-gray-700 mb-2">Filter Kategori:</div>
                    <div class="flex flex-wrap gap-2">
                        <button class="category-btn bg-indigo-600 text-white px-4 py-2 rounded-full border border-indigo-600 font-medium flex items-center gap-2 transition hover:bg-indigo-700 active" data-category="all">
                            <i class="fas fa-layer-group"></i> Semua
                        </button>
                        <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50" data-category="sosiologi">
                            <i class="fas fa-comments"></i> Sosiologi & Komunikasi
                        </button>
                        <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50" data-category="psikologi">
                            <i class="fas fa-brain"></i> Psikologi & Pendidikan
                        </button>
                        <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50" data-category="ekonomi">
                            <i class="fas fa-chart-line"></i> Ekonomi & Manajemen
                        </button>
                        <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50" data-category="seni">
                            <i class="fas fa-palette"></i> Seni, Budaya & Sejarah
                        </button>
                        <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50" data-category="bahasa">
                            <i class="fas fa-book-open"></i> Bahasa & Sastra
                        </button>
                    </div>
                </div>
                
                <!-- Sort Filter -->
                <div class="w-full md:w-auto">
                    <div class="text-sm font-medium text-gray-700 mb-2">Urutkan Berdasarkan:</div>
                    <div class="flex flex-wrap gap-2">
                        <button id="sortNewest" class="sort-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50 active">
                            <i class="fas fa-sort-amount-down"></i> Terbaru
                        </button>
                        <button id="sortOldest" class="sort-btn bg-white text-gray-700 px-4 py-2 rounded-full border border-gray-300 font-medium flex items-center gap-2 transition hover:bg-gray-50">
                            <i class="fas fa-sort-amount-up"></i> Terlama
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Breakdown -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-8">
            <h2 class="font-poppins font-semibold text-xl md:text-2xl text-gray-800 mb-5 flex items-center gap-3">
                <i class="fas fa-chart-pie text-indigo-600"></i> Jumlah Kelompok Berdasarkan Kategori
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4" id="categoryList">
                <!-- Category items will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Cards Container -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10" id="dataContainer">
            <!-- Cards will be inserted here by JavaScript -->
        </div>

        <!-- Footer -->
        <footer class="text-center py-6 border-t border-gray-200 text-gray-600 text-sm">
            <p>Database OPSI Sosial Humaniora • Data diperbarui dari Google Sheets • 
                <a href="https://docs.google.com/spreadsheets/d/1YPD4iWjoDN59wKtCXFomwjAcIrAjGLWir8Ul-4imlpI" 
                   target="_blank" 
                   class="text-indigo-600 font-medium hover:underline">
                   Lihat Sumber Data
                </a>
            </p>
        </footer>
    </div>

    <script>
        google.charts.load('current', {'packages':['table']});
        google.charts.setOnLoadCallback(loadData);

        let allData = [];
        let currentSort = 'newest'; // Default sort: terbaru
        let categoryCounts = {
            'sosiologi': 0,
            'psikologi': 0,
            'ekonomi': 0,
            'seni': 0,
            'bahasa': 0,
            'lainnya': 0
        };

        // Kategori mapping
        const categoryMapping = {
            'sosiologi': ['sosiologi', 'komunikasi', 'rekayasa sosial', 'antropologi'],
            'psikologi': ['psikologi', 'pendidikan'],
            'ekonomi': ['ekonomi', 'manajemen'],
            'seni': ['seni', 'budaya', 'sejarah'],
            'bahasa': ['bahasa', 'sastra']
        };

        function loadData() {
            const sheetID = '1YPD4iWjoDN59wKtCXFomwjAcIrAjGLWir8Ul-4imlpI';
            const gid = '561455291';
            const query = new google.visualization.Query(
                `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?gid=${gid}`
            );

            query.send(handleQueryResponse);
        }

        function handleQueryResponse(response) {
            if (response.isError()) {
                showError();
                return;
            }

            const data = response.getDataTable();
            allData = [];
            
            // Reset counts
            Object.keys(categoryCounts).forEach(key => categoryCounts[key] = 0);

            // Simulasikan tanggal untuk data (karena spreadsheet tidak memiliki kolom tanggal)
            // Dalam implementasi nyata, Anda harus memiliki kolom tanggal di spreadsheet
            const baseDate = new Date(2024, 0, 1); // 1 Januari 2024
            
            for (let i = 0; i < data.getNumberOfRows(); i++) {
                const ketua = data.getValue(i, 1) || "Tidak ada data";
                const anggota = data.getValue(i, 2) || "Tidak ada data";
                const kategori = data.getValue(i, 3) || "Lainnya";
                const judul = data.getValue(i, 4) || "Tanpa judul";
                
                // Normalize category
                const normalizedKategori = normalizeCategory(kategori);
                
                // Generate tanggal acak untuk simulasi (dalam implementasi nyata, ambil dari kolom tanggal)
                const simulatedDate = new Date(baseDate);
                simulatedDate.setDate(simulatedDate.getDate() + i); // Tambahkan hari berdasarkan index
                
                allData.push({
                    ketua: ketua.trim(),
                    anggota: anggota.trim(),
                    kategori: kategori.trim(),
                    judul: judul.trim(),
                    normalizedKategori: normalizedKategori,
                    searchText: `${ketua} ${anggota} ${kategori} ${judul}`.toLowerCase(),
                    date: simulatedDate // Tanggal simulasi
                });
                
                // Update category count
                categoryCounts[normalizedKategori]++;
            }
            
            updateStatistics();
            renderCategoryBreakdown();
            applySorting();
            renderCards(allData);
        }

        function normalizeCategory(category) {
            const lowerCat = category.toLowerCase();
            
            for (const [key, keywords] of Object.entries(categoryMapping)) {
                if (keywords.some(keyword => lowerCat.includes(keyword))) {
                    return key;
                }
            }
            
            return 'lainnya';
        }

        function updateStatistics() {
            document.getElementById('totalGroups').textContent = allData.length;
        }

        function renderCategoryBreakdown() {
            const categoryList = document.getElementById('categoryList');
            const categories = [
                { name: 'Sosiologi & Komunikasi', key: 'sosiologi', icon: 'fas fa-comments', color: 'bg-blue-100 text-blue-800' },
                { name: 'Psikologi & Pendidikan', key: 'psikologi', icon: 'fas fa-brain', color: 'bg-purple-100 text-purple-800' },
                { name: 'Ekonomi & Manajemen', key: 'ekonomi', icon: 'fas fa-chart-line', color: 'bg-yellow-100 text-yellow-800' },
                { name: 'Seni, Budaya & Sejarah', key: 'seni', icon: 'fas fa-palette', color: 'bg-pink-100 text-pink-800' },
                { name: 'Bahasa & Sastra', key: 'bahasa', icon: 'fas fa-book-open', color: 'bg-green-100 text-green-800' },
                { name: 'Lainnya', key: 'lainnya', icon: 'fas fa-ellipsis-h', color: 'bg-gray-100 text-gray-800' }
            ];
            
            categoryList.innerHTML = categories.map(cat => `
                <div class="bg-gray-50 rounded-xl p-4 border-l-4 ${cat.color.split(' ')[0]} border-current transition hover:shadow-md">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium ${cat.color}">${cat.name}</div>
                        </div>
                        <div class="${cat.color.split(' ')[1]} font-bold text-xl">${categoryCounts[cat.key]}</div>
                    </div>
                    <div class="mt-3 flex items-center text-sm ${cat.color.split(' ')[1]}">
                        <i class="${cat.icon} mr-2"></i>
                        <span>${Math.round((categoryCounts[cat.key] / allData.length) * 100) || 0}% dari total</span>
                    </div>
                </div>
            `).join('');
        }

        function applySorting() {
            if (currentSort === 'newest') {
                // Urutkan dari terbaru ke terlama
                allData.sort((a, b) => b.date - a.date);
            } else {
                // Urutkan dari terlama ke terbaru
                allData.sort((a, b) => a.date - b.date);
            }
        }

        function renderCards(data) {
            const container = document.getElementById('dataContainer');
            
            if (data.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full bg-white rounded-2xl shadow-sm border border-gray-200 p-10 text-center">
                        <i class="fas fa-search text-5xl text-gray-300 mb-4"></i>
                        <h3 class="font-poppins font-semibold text-xl text-gray-800 mb-2">Tidak ditemukan kelompok yang sesuai</h3>
                        <p class="text-gray-600 max-w-md mx-auto">Coba gunakan kata kunci pencarian yang berbeda atau pilih kategori lain</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-2xl card-shadow border border-gray-200 p-6 transition-all hover:-translate-y-2 relative overflow-hidden';
                
                // Get category styling
                const categoryStyle = getCategoryStyle(item.normalizedKategori);
                
                // Format tanggal
                const formattedDate = item.date.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                card.innerHTML = `
                    <div class="absolute top-0 left-0 right-0 h-1 ${categoryStyle.gradient}"></div>
                    <h3 class="font-poppins font-semibold text-lg text-gray-800 mb-4 line-clamp-2">${item.judul}</h3>
                    
                    <div class="space-y-4 mb-5">
                        <div class="flex">
                            <div class="w-10 flex-shrink-0">
                                <i class="fas fa-user-circle ${categoryStyle.text}"></i>
                            </div>
                            <div>
                                <div class="font-medium text-gray-700">Ketua:</div>
                                <div class="text-gray-600">${item.ketua}</div>
                            </div>
                        </div>
                        
                        <div class="flex">
                            <div class="w-10 flex-shrink-0">
                                <i class="fas fa-users ${categoryStyle.text}"></i>
                            </div>
                            <div>
                                <div class="font-medium text-gray-700">Anggota:</div>
                                <div class="text-gray-600">${item.anggota}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                        <div class="inline-flex items-center gap-2 ${categoryStyle.bg} ${categoryStyle.text} px-4 py-2 rounded-full text-sm font-medium">
                            <i class="${categoryStyle.icon}"></i>
                            ${item.kategori}
                        </div>
                        <div class="text-xs text-gray-500">
                            <i class="fas fa-calendar-day mr-1"></i> ${formattedDate}
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function getCategoryStyle(category) {
            const styles = {
                'sosiologi': {
                    bg: 'bg-blue-100',
                    text: 'text-blue-700',
                    icon: 'fas fa-comments',
                    gradient: 'bg-gradient-to-r from-blue-500 to-cyan-500'
                },
                'psikologi': {
                    bg: 'bg-purple-100',
                    text: 'text-purple-700',
                    icon: 'fas fa-brain',
                    gradient: 'bg-gradient-to-r from-purple-500 to-pink-500'
                },
                'ekonomi': {
                    bg: 'bg-yellow-100',
                    text: 'text-yellow-700',
                    icon: 'fas fa-chart-line',
                    gradient: 'bg-gradient-to-r from-yellow-500 to-orange-500'
                },
                'seni': {
                    bg: 'bg-pink-100',
                    text: 'text-pink-700',
                    icon: 'fas fa-palette',
                    gradient: 'bg-gradient-to-r from-pink-500 to-rose-500'
                },
                'bahasa': {
                    bg: 'bg-green-100',
                    text: 'text-green-700',
                    icon: 'fas fa-book-open',
                    gradient: 'bg-gradient-to-r from-green-500 to-emerald-500'
                },
                'lainnya': {
                    bg: 'bg-gray-100',
                    text: 'text-gray-700',
                    icon: 'fas fa-ellipsis-h',
                    gradient: 'bg-gradient-to-r from-gray-500 to-gray-700'
                }
            };
            
            return styles[category] || styles['lainnya'];
        }

        function filterData() {
            const searchKeyword = document.getElementById('searchInput').value.toLowerCase();
            const activeCategory = document.querySelector('.category-btn.active').dataset.category;
            
            let filtered = allData;
            
            // Apply category filter
            if (activeCategory !== 'all') {
                filtered = filtered.filter(item => item.normalizedKategori === activeCategory);
            }
            
            // Apply search filter
            if (searchKeyword.trim() !== '') {
                filtered = filtered.filter(item => 
                    item.searchText.includes(searchKeyword)
                );
            }
            
            // Apply current sorting
            applySorting();
            
            renderCards(filtered);
        }

        function showError() {
            const container = document.getElementById('dataContainer');
            container.innerHTML = `
                <div class="col-span-full bg-white rounded-2xl shadow-sm border border-gray-200 p-10 text-center">
                    <i class="fas fa-exclamation-triangle text-5xl text-red-300 mb-4"></i>
                    <h3 class="font-poppins font-semibold text-xl text-gray-800 mb-2">Gagal memuat data</h3>
                    <p class="text-gray-600 mb-6">Pastikan koneksi internet Anda stabil dan coba lagi nanti.</p>
                    <button onclick="loadData()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-xl transition flex items-center gap-2 mx-auto">
                        <i class="fas fa-redo"></i> Muat Ulang Data
                    </button>
                </div>
            `;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Search input event
            document.getElementById('searchInput').addEventListener('input', filterData);
            
            // Category filter events
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('active', 'bg-indigo-600', 'text-white', 'border-indigo-600');
                        b.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                    });
                    
                    this.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
                    this.classList.add('active', 'bg-indigo-600', 'text-white', 'border-indigo-600');
                    filterData();
                });
            });
            
            // Sort button events
            document.getElementById('sortNewest').addEventListener('click', function() {
                document.querySelectorAll('.sort-btn').forEach(b => {
                    b.classList.remove('active', 'bg-indigo-600', 'text-white', 'border-indigo-600');
                    b.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                });
                
                this.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
                this.classList.add('active', 'bg-indigo-600', 'text-white', 'border-indigo-600');
                currentSort = 'newest';
                applySorting();
                filterData();
            });
            
            document.getElementById('sortOldest').addEventListener('click', function() {
                document.querySelectorAll('.sort-btn').forEach(b => {
                    b.classList.remove('active', 'bg-indigo-600', 'text-white', 'border-indigo-600');
                    b.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                });
                
                this.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
                this.classList.add('active', 'bg-indigo-600', 'text-white', 'border-indigo-600');
                currentSort = 'oldest';
                applySorting();
                filterData();
            });
            
            // Enter key for search
            document.getElementById('searchInput').addEventListener('keyup', function(event) {
                if (event.key === "Enter") {
                    filterData();
                }
            });
        });
    </script>
</body>
</html>
